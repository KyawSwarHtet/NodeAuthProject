{"version":3,"sources":["userController.js"],"names":["jwt","require","fs","mainPath","User","bcrypt","asyncHandler","req","res","render","path","registerUser","_req$body","username","email","password","regeneratorRuntime","async","_context","prev","next","body","trim","abrupt","status","json","message","test","length","awrap","find","then","result","hash","hashedPassword","save","console","log","err","newUser","stop","_req$body2","user","_context2","findOne","sent","t0","compare","updateOne","_id","id","login","loginUser","token","generateToken","sign","concat","process","env","JWT_SECRET","expiresIn","updateUser","_req$body3","address","gender","profilePicture","userDetail","filesArray","file","updatedData","_context3","findById","undefined","fileName","filename","fileType","mimetype","size","unlink","join","filePath","$set","bytes","decimal","dm","index","Math","floor","pow","toFixed","deleteUserAccount","_context4","fileSize","findByIdAndRemove","exec"],"mappings":"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","file":"userController.min.js","sourcesContent":["const jwt = require(\"jsonwebtoken\")\r\nconst fs = require(\"fs\");\r\nconst asyncHandler = require(\"express-async-handler\");\r\nconst mainPath = require(\"./baseFilepath\");\r\nconst User = require('../model/userModel')\r\nconst bcrypt = require(\"bcryptjs\");\r\nconst path = require(\"path\");\r\n\r\n\r\n\r\nconst getAllUser = (req,res) => {\r\n    res.render(\"user/register\", {\r\n        pageTitle: \"Register\",\r\n        path:\"/register\"\r\n        \r\n    })\r\n}\r\n\r\n//Register user\r\n//@route Post/api/users/\r\nconst registerUser = asyncHandler(async (req, res) => {\r\n  let { username, email, password} = req.body;\r\n\r\n  username = username.trim();\r\n  email = email.trim();\r\n  password = password.trim();\r\n\r\n  if (!username || !email || !password) {\r\n  return  res.status(404).json({\r\n      status: \"FAILED\",\r\n      message: \"Empty input Fields!\",\r\n    });\r\n \r\n  }\r\n\r\n  //checking user name\r\n  if (!/^[a-zA-Z ]*$/.test(username)) {\r\n   return res.status(400).json({\r\n      status: \"FAILED\",\r\n      message: \"Invalid name entered\",\r\n    });\r\n  }\r\n\r\n  //checking email\r\n  if (!/^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/.test(email)) {\r\n  return  res.status(400).json({\r\n      status: \"FAILED\",\r\n      message: \"Invalid email entered\",\r\n    });\r\n  }\r\n  //checking password length\r\n  if (password.length < 8) {\r\n   return res.status(400).json({\r\n      status: \"FAILED\",\r\n      message: \"Password is too short!\",\r\n    });\r\n  }\r\n  \r\n  //find user email from database\r\n    await User.find({ email })\r\n      .then((result) => {\r\n        if (result.length) {\r\n          //A user already exits\r\n        return  res.status(400).json({\r\n            status: \"FAILED\",\r\n            message: \"User with the provided email already exists\",\r\n          })\r\n\r\n        } \r\n          //to create a new user\r\n          //password handling\r\n          const saltRounds = 10;\r\n          bcrypt\r\n            .hash(password, saltRounds)\r\n            .then((hashedPassword) => {\r\n              const newUser = new User({\r\n                username,\r\n                email,\r\n                password: hashedPassword,\r\n              });\r\n              newUser\r\n                .save()\r\n                .then((result) => {\r\n                  //handle account verification\r\n                  console.log(\"user  post is success\");\r\n                 \r\n                  res.status(201).json(result);\r\n                  //  res.redirect(\"/register\");\r\n                 \r\n                })\r\n                .catch((err) => {\r\n                  res.status(400).json({\r\n                    status: \"FAILED\",\r\n                    message: \"An error occurred while saving user account!\",\r\n                  });\r\n                });\r\n            })\r\n            .catch((err) => {\r\n              res.status(400).json({\r\n                status: \"FAILED\",\r\n                message: \"An error occurred while hashing password!\",\r\n              });\r\n            });\r\n        \r\n      })\r\n      .catch((err) => {\r\n        res.status(400).json({\r\n          status: \"FAILED\",\r\n          message: \"An error occured while checking for existing user!\",\r\n        });\r\n      });\r\n  \r\n});\r\n\r\n//@route Post/api/users/login\r\nconst loginUser = asyncHandler(async (req, res) => {\r\n  let {  email, password } = req.body;\r\n  email = email.trim();\r\n  password = password.trim();\r\n\r\n  if (email == \"\" || password == \"\") {\r\n   return res.status(400).json({\r\n      status: \"FAILED\",\r\n      message: \"Empty credentials supplied\",\r\n    })\r\n  }\r\n\r\n    /* Check for user email*/\r\n    const user = await User.findOne({ email });\r\n    if (user && (await bcrypt.compare(password,user.password))) {\r\n     \r\n        User.updateOne({ _id: user.id }, { login: true })\r\n          .then(() => {\r\n            res.status(201).json({\r\n              _id: user.id,\r\n              username: user.username,\r\n              email: user.email,             \r\n              login: true,\r\n              token: generateToken(user._id),\r\n            });\r\n          })\r\n          .catch((err) => {\r\n            res.status(400).json({\r\n              status: \"FAILED\",\r\n              message: \"An error occur while updating login data update\",\r\n            });\r\n          });\r\n    } else {\r\n      res.status(400).json({\r\n        status: \"FAILED\",\r\n        message: \"Email, Password is something wrong\",\r\n      });\r\n    }\r\n  \r\n});\r\n\r\n/*Generate JWT */\r\nconst generateToken = (id) => {\r\n  return jwt.sign({ id }, `${process.env.JWT_SECRET}`, {\r\n    expiresIn: \"30d\",\r\n  });\r\n};\r\n\r\n//update user fucntion\r\nconst updateUser = asyncHandler(async (req, res) => {\r\n  const { username,address,gender  } = req.body;\r\n  const profilePicture = req.file;\r\n  console.log(\"profile picture\",profilePicture)\r\n    const id = req.user.id;\r\n \r\n  const userDetail = await User.findById(id);\r\n\r\n  /* Check for user */\r\n  if (!req.user) {\r\n    return res.status(404).json({\r\n      status: \"FAILED\",\r\n        message: \"user not found\",    \r\n   })\r\n  }\r\n\r\n  let filesArray = [];\r\n  if (profilePicture !== undefined && profilePicture !== []) {\r\n    const file = {\r\n      fileName: profilePicture.filename,\r\n      filePath: profilePicture.path,\r\n      fileType: profilePicture.mimetype,\r\n      fileSize: fileSizeFormatter(profilePicture.size,2),\r\n    };\r\n    filesArray.push(file);\r\n\r\n\r\n    if (userDetail.profilePicture[0] !== \"\") {\r\n         //for Image File to when when we do update picture\r\n      fs.unlink(path.join(mainPath, userDetail.profilePicture[0].filePath), (err) => {\r\n          if (err) {\r\n          return  console.log(\"error occur\", err);\r\n          }\r\n          console.log(\"file is deleted successully\");\r\n        });     \r\n    }\r\n    //update user\r\n  await User.updateOne(\r\n    { _id: id },\r\n    {\r\n      $set: {\r\n        username: username,\r\n        login: true,\r\n        gender: gender,\r\n        address: address,\r\n        profilePicture: filesArray,\r\n      },\r\n    }\r\n  );\r\n  } else {\r\n     //update user\r\n  await User.updateOne(\r\n    { _id: id },\r\n    {\r\n      $set: {\r\n        username: username,\r\n        login: true,\r\n        gender: gender,\r\n        address: address,\r\n      },\r\n    }\r\n  );\r\n  }\r\n  const updatedData = await User.findById(id);\r\n\r\n  res.status(200).json({\r\n    _id: id,\r\n    username: updatedData.username,\r\n    email: updatedData.email,\r\n    address: updatedData.address,\r\n    gender: updatedData.gender,\r\n    profilePicture: updatedData.profilePicture,\r\n    login: updatedData.login,\r\n  });\r\n});\r\n\r\n//for img file format\r\nconst fileSizeFormatter = (bytes, decimal) => {\r\n  if (bytes === 0) {\r\n    return \"0 byte\";\r\n  }\r\n  const dm = decimal || 2;\r\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"YB\", \"ZB\"];\r\n  const index = Math.floor(Math.log(bytes) / Math.log(1000));\r\n  return (\r\n    parseFloat((bytes / Math.pow(1000, index)).toFixed(dm)) + \"-\" + sizes[index]\r\n  );\r\n};\r\n\r\n// for all deletepost\r\n//@route Delete/api/deletepost/:id\r\nconst deleteUserAccount = async (req, res) => {\r\n  // const id = req.params.id;\r\n  const id = req.user.id;\r\n  // console.log(\"id is\",id)\r\n  const userDetail = await User.findById(id);\r\n  // console.log(\"user detail id\",userDetail)\r\n\r\n  /* Check for user */\r\n  if (!req.user) {\r\n     return res.status(404).json({\r\n      status: \"FAILED\",\r\n        message: \"user not found\",    \r\n   }) \r\n  }\r\n  userDetail.profilePicture[0] === '' || userDetail.profilePicture.length === 0\r\n      ? console.log(\"file is empty file\")\r\n      :       \r\n       fs.unlink(path.join(mainPath, userDetail.profilePicture[0].filePath), (err) => {\r\n          // return fs.unlink(path.join(data.filePath), (err) => {\r\n            if (err) {\r\n            return  console.log(\"error occur\", err);\r\n            }\r\n             console.log(\"file is deleted successully\");\r\n          });\r\n\r\n  await User.findByIdAndRemove(id).exec();\r\n  res.status(200).json( \"User Account Deleted Successfully\");\r\n  // res.send();\r\n};\r\n\r\n\r\nmodule.exports = {getAllUser,registerUser,loginUser,updateUser,deleteUserAccount}"]}